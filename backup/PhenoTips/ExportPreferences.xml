<?xml version='1.0' encoding='UTF-8'?>
<xwikidoc version="1.1">
  <web>PhenoTips</web>
  <name>ExportPreferences</name>
  <language />
  <defaultLanguage />
  <translation>0</translation>
  <creator>XWiki.Admin</creator>
  <creationDate>1341762326000</creationDate>
  <parent>PhenoTips.Export</parent>
  <author>XWiki.sdumitriu</author>
  <contentAuthor>XWiki.sdumitriu</contentAuthor>
  <date>1411434810000</date>
  <contentUpdateDate>1411434810000</contentUpdateDate>
  <version>5.1</version>
  <title />
  <comment>Install extensoin [org.phenotips:phenotips-data-export-ui-1.0-rc-1]</comment>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{include document="PhenoTips.DatabaseFilters" /}}

{{velocity output=false}}
#macro(__export__displayFieldList $xclassName $targetFieldName $customValues $ignored $codeFields $valueList $activeFields)
  {{html clean="false"}}
    #set($xclass = $xwiki.getDocument($xclassName).getxWikiClass())
    &lt;ul class="field-list">
      #foreach($customVal in $customValues.keySet())
        &lt;li>
          &lt;label for="${targetFieldName}_${customVal}">
            &lt;input type="checkbox" name="${targetFieldName}" id="${targetFieldName}_${customVal}" value="$customVal"#if ($valueList.contains($customVal) || true) checked="checked"#end/>
            ${customValues.get($customVal)}
          &lt;/label>
        &lt;/li>
      #end
      #foreach ($field in $xclass.properties)
        #if (($activeFields.size() == 0 || $activeFields.contains(${field.name})) &amp;&amp; !$ignored.fields.contains(${field.name}) &amp;&amp; !$ignored.types.contains(${field.type}))
        &lt;li>
          &lt;label for="${targetFieldName}_${field.name}">
          &lt;input type="checkbox" name="${targetFieldName}" id="${targetFieldName}_${field.name}" value="${field.name}" #if($valueList.contains(${field.name}) || true) checked="checked" #end />
          ${field.prettyName}
        &lt;/li>
        #if ($codeFields.contains(${field.name}))
        &lt;li>
          &lt;label for="${targetFieldName}_${field.name}_code">
          &lt;input type="checkbox" name="${targetFieldName}" id="${targetFieldName}_${field.name}_code" value="${field.name}_code" #if($valueList.contains("${field.name}_code")) checked="checked" #end />
          ${field.prettyName} (ontology term ID)
        &lt;/li>
        &lt;li>
          &lt;label for="${targetFieldName}_${field.name}_combined">
          &lt;input type="checkbox" name="${targetFieldName}" id="${targetFieldName}_${field.name}_combined" value="${field.name}_combined" #if($valueList.contains("${field.name}_combined")) checked="checked" #end />
          ${field.prettyName} (ontology term ID and term name)
        &lt;/li>
        #end
        #if ($metaFields.contains(${field.name}))
        &lt;li>
          &lt;label for="${targetFieldName}_${field.name}_code_meta">
          &lt;input type="checkbox" name="${targetFieldName}" id="${targetFieldName}_${field.name}_code_meta" value="${field.name}_code_meta" #if($valueList.contains("${field.name}_code_meta")) checked="checked" #end />
          ${field.prettyName} (ontology term and metadata IDs)
        &lt;/li>
        &lt;li>
          &lt;label for="${targetFieldName}_${field.name}_meta">
          &lt;input type="checkbox" name="${targetFieldName}" id="${targetFieldName}_${field.name}_meta" value="${field.name}_meta" #if($valueList.contains("${field.name}_meta") || true) checked="checked" #end />
          ${field.prettyName} (ontology term and metadata names)
        &lt;/li>
        #end
        #end
      #end
    &lt;/ul>
    &lt;input type="hidden" name="${targetFieldName}" value="" />
  {{/html}}
#end
{{/velocity}}

{{velocity}}
{{html clean="false" filter="indent"}}&lt;form class="xform" action="$xwiki.getURL('PhenoTips.Export', 'get', "space=data&amp;outputSyntax=plain")" method="post">&lt;div>{{/html}}
(% class="section filters"%)(((
=== (% class="step" %)1(%%) Filter records you wish to export ===

#__filters_display('export-filters')

{{info}}**(% id="filter-match-count"%) (%%)** matching records {{/info}}
)))##section filters

(% class="section columns"%)(((
#if ($request.multipatient)
=== (% class="step" %)2(%%) Select the fields to be included in pushed data ===
  #set($activeFields = ['external_id', 'gender', 'phenotype', 'negative_phenotype', 'omim_id'])
  #set($ignored = {})
  #set($customValues = {})
  #set($codeFields = [])
  #set($metaFields = [])
  #set($selectedValues = [])
  #__export__displayFieldList( "PhenoTips.PatientClass" 'columns' $customValues $ignored $codeFields $selectedValues $activeFields)
  #set($exportTitle = "Push to " + $request.remoteserver)
  #set($exportButtonID = "push-multiple-patients")
#else
=== (% class="step" %)2(%%) Select the fields to be exported ===
  #set($ignored = {
    'fields' : ['reports_history', 'pedigree', 'extended_negative_phenotype'],
    'types'  : []
  })
  #set($customValues = {
       'doc.name' : "Report identifier",
       'referrer' : "Referrer (report creator)",
       'creationDate' : "Report creation date",
       'author' : "Last modified by",
       'date' : "Last modification date"
  })
  #set($codeFields = ['phenotype', 'negative_phenotype', 'prenatal_phenotype', 'omim_id'])
  #set($metaFields = ['phenotype'])
  #set($selectedValues = ['phenotype'])
  #__export__displayFieldList( "PhenoTips.PatientClass" 'columns' $customValues $ignored $codeFields $selectedValues)
  #set($exportTitle = "Export")
  #set($exportButtonID = "export-multiple-patients")
#end
)))##section columns

(% class="buttons"%)(((
{{html clean="false"}}&lt;input type="hidden" name="space" value="$!request.space"/>&lt;input type="hidden" name="outputSyntax" value="plain"/>&lt;span class="buttonwrapper">&lt;input type="submit" id="$exportButtonID" value="$exportTitle" class="button" id="export_submit"/>&lt;/span> &lt;span class="buttonwrapper">&lt;input type="button" value="Cancel" class="button secondary" id="export_cancel"/>&lt;/span>{{/html}}
{{html clean="false"}}&lt;/div>&lt;/form>{{/html}}
)))
{{/velocity}}</content>
</xwikidoc>