<?xml version='1.0' encoding='UTF-8'?>
<xwikidoc version="1.1">
  <web>IRC</web>
  <name>phenotipsArchive20131122</name>
  <language />
  <defaultLanguage />
  <translation>0</translation>
  <creator>XWiki.sdumitriu</creator>
  <creationDate>1385118705000</creationDate>
  <parent>IRC.WebHome</parent>
  <author>XWiki.sdumitriu</author>
  <contentAuthor>XWiki.sdumitriu</contentAuthor>
  <date>1385149903000</date>
  <contentUpdateDate>1385149903000</contentUpdateDate>
  <version>1.76</version>
  <title>IRC Archive for channel #phenotips on 22 November 2013</title>
  <comment>Logging from IRC</comment>
  <minorEdit>true</minorEdit>
  <syntaxId>plain/1.0</syntaxId>
  <hidden>false</hidden>
  <content>&lt;zladlie> has joined #phenotips
06:12 &lt;zladlie> hello, again. I have a development question
06:12 &lt;sdumitriu> Hi zladlie
06:13 &lt;zladlie> I'm trying to alter the pdf export by printing some of the patient info on the footer
06:14 &lt;zladlie> So far, I have been unsuccessful by changing the footer section of PatientSheetCode.xml. Am I changing the right file?
06:19 &lt;sdumitriu> Yes
06:19 &lt;sdumitriu> That's the right file
06:19 &lt;sdumitriu> What do you mean by "footer section"?
06:20 &lt;zladlie> The footer is at the bottom of the page on every page
06:20 &lt;zladlie> In PatientSheetCode.xml, there is a section of XSL that starts with the comment "&amp;lt;!-- Change the footer --&amp;gt;"
06:21 &lt;zladlie> There I tried to use XSL matches on the element I want shown in the footer, but it does not seem to work
06:21 &lt;sdumitriu> This is where the export process is explained: http://platform.xwiki.org/xwiki/bin/view/AdminGuide/Configuration#HCustomizingthePDFexportLook26Feel
06:23 &lt;sdumitriu> What selector did you use?
06:23 &lt;zladlie> I have seen that document, but Phenotips doesn't have the XWiki.XWikiSkins page shown in the pictures
06:23 &lt;sdumitriu> Note that if you're using a relative selector, it only looks inside the page-footer element
06:24 &lt;zladlie> xsl:value-of
06:25 &lt;sdumitriu> It would be faster to work in the running instance: http://localhost:8080/bin/edit/PhenoTips/PatientSheetCode?editor=object&amp;classname=XWiki.PDFClass&amp;object=0
06:25 &lt;zladlie> I need an absolute selector? Starting from xwikidoc/ ?
06:25 &lt;sdumitriu> If I remember correctly, start with // (recursively search from the root)
06:26 &lt;zladlie> With that link I get 404 not found and my local host is running
06:29 &lt;sdumitriu> Are you using the standalone package?
06:29 &lt;sdumitriu> Or Tomcat?
06:31 &lt;sdumitriu> By the way, there is a skin document, it's PhenoTips.Skin, in the resources/ui module
06:35 &lt;zladlie> Using Jetty
06:49 &lt;sdumitriu> Keep in mind that the xsl is applied on a special HTML, you can see it by appending ?xpage=pdf to a patient sheet in the running instance
07:07 &lt;sdumitriu> And actually, xhtml2fo.xsl is applied on the HTML, fop.xsl which you're modifying is applied on the result of the first transformation, on a .fo file
07:09 &lt;zladlie> So xhtml2fo.xsl is first?
07:11 &lt;sdumitriu> Yes
07:27 &lt;zladlie> How is PatientClass.xml used in relation to PatientClassCode.xml?
07:34 &lt;sdumitriu> PatientClass contains the definition of the data structure used for storing patients
07:35 &lt;sdumitriu> PatientSheet is used to display instances of that class
07:35 &lt;sdumitriu> Which in turn uses two other documents:
07:35 &lt;sdumitriu> PatientSheetMacros contains macros used to display different types of properties
07:36 &lt;sdumitriu> And PatientSheetCode contains JavaScript and CSS extensions that add behavior and style
07:39 &lt;zladlie> How would I gain access to nodes of PatientClass.xml in PatientSheetCode.xml?
07:40 &lt;sdumitriu> I don't understand the question...
07:41 &lt;zladlie> PatientSheetCode.xml contains the XSL script to format the PDF export, and PatientClass.xml contains the node that I want to print on the PDF
07:43 &lt;sdumitriu> Let's start from the beginning, what are you trying to accomplish? Print the patient's external identifier in the PDF?
07:44 &lt;zladlie> Yes
07:44 &lt;sdumitriu> OK, there's a simpler solution to that
07:46 &lt;sdumitriu> 1. On the filesystem, where you have the running instance, find webapps/phenotips/templats/pdffooter.vm
07:46 &lt;sdumitriu> Copy it someplace else and edit it
07:46 &lt;sdumitriu> 2. What exactly do you want it to say?
07:48 &lt;zladlie> Yeah, I had found the pdffooter.vm but couldn't find documentation on which variable bindings it has
07:48 &lt;zladlie> I want it to show the patient identifier on the footer
07:49 &lt;sdumitriu> Just that?
07:49 &lt;sdumitriu> Replace the current content with:
07:50 &lt;sdumitriu> $doc.display('external_id')
07:52 &lt;zladlie> Then how is the copied vm file used?
07:52 &lt;zladlie> Sorry for the simple questions, I'm new to the XWiki framework
07:53 &lt;sdumitriu> 3. In your running instance, go to the PhenoTips/Skin document
07:53 &lt;sdumitriu> What's the URL for it?
07:56 &lt;zladlie> http://localhost:8080/phenotips/bin/edit/PhenoTips/Skin
08:11 &lt;sdumitriu> So go to http://localhost:8080/phenotips/bin/edit/PhenoTips/Skin?viewer=attachments
08:11 &lt;sdumitriu> Upload the modified pdffooter.vm
08:11 &lt;sdumitriu> Edit the fop.xsl code at http://localhost:8080/phenotips/bin/edit/PhenoTips/PatientSheetCode?editor=object&amp;classname=XWiki.PDFClass&amp;object=0&amp;property=fopxsl
08:12 &lt;sdumitriu> Remove the "Change the footer" template
08:12 &lt;sdumitriu> Save
08:12 &lt;sdumitriu> Try the PDF export now
08:13 &lt;sdumitriu> 4. Export as XAR the two changed documents, PhenoTips.PatientSheetCode and PhenoTips.Skin
08:13 &lt;sdumitriu> Extract the XMLs from the two .xar files into the proper places
08:14 &lt;sdumitriu> Run "mvn xar:format" in the two modules, components/patient-data/ui and resources/ui
08:15 &lt;sdumitriu> You have to manually copy the license header from another XML file into these, since the export doesn't keep the license header and the build will fail if it doesn't find all the headers in place
08:17 &lt;zladlie> There doesn't look to be anywhere to upload the vm file
08:24 &lt;sdumitriu> Oh, right
08:24 &lt;sdumitriu> http://localhost:8080/phenotips/bin/PhenoTips/Skin?viewer=attachments
08:26 &lt;zladlie> Ah I see, thanks
08:27 &lt;zladlie> If pdffooter.vm is not listed, will uploading it still cause it to be replaced?
08:27 &lt;sdumitriu> Yes
08:28 &lt;sdumitriu> It doesn't replace the one found on the filesystem, it overrides it
08:34 &lt;sdumitriu> Leaving for a while, back in 30
08:38 &lt;zladlie> Thank you for the help
09:02 &lt;sdumitriu1> has joined #phenotips
12:15 &lt;zladlie> has left #phenotips
14:12 &lt;sdumitriu1> has quit
14:51 &lt;natani> has quit</content>
  <object>
    <name>IRC.phenotipsArchive20131122</name>
    <number>0</number>
    <className>IRC.IRCBotArchiveClass</className>
    <guid>714bb5df-0d37-49a3-8309-0f67eacdf745</guid>
    <class>
      <name>IRC.IRCBotArchiveClass</name>
      <customClass />
      <customMapping />
      <defaultViewSheet />
      <defaultEditSheet />
      <defaultWeb />
      <nameField />
      <validationScript />
      <channel>
        <customDisplay />
        <disabled>0</disabled>
        <name>channel</name>
        <number>1</number>
        <picker>0</picker>
        <prettyName>Channel</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage />
        <validationRegExp />
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </channel>
    </class>
    <property>
      <channel>phenotips</channel>
    </property>
  </object>
</xwikidoc>