<?xml version='1.0' encoding='UTF-8'?>
<xwikidoc version="1.1">
  <web>IRC</web>
  <name>medsavantArchive20130612</name>
  <language />
  <defaultLanguage />
  <translation>0</translation>
  <creator>XWiki.sdumitriu</creator>
  <creationDate>1371018487000</creationDate>
  <parent>IRC.WebHome</parent>
  <author>XWiki.sdumitriu</author>
  <contentAuthor>XWiki.sdumitriu</contentAuthor>
  <date>1371078975000</date>
  <contentUpdateDate>1371078975000</contentUpdateDate>
  <version>1.151</version>
  <title>IRC Archive for channel #medsavant on 12 June 2013</title>
  <comment>Logging from IRC</comment>
  <minorEdit>true</minorEdit>
  <syntaxId>plain/1.0</syntaxId>
  <hidden>false</hidden>
  <content>&lt;sdumitriu> has joined #medsavant
08:52 &lt;sdumitriu> has joined #medsavant
11:20 &lt;bvancea> has joined #medsavant
11:21 &lt;sdumitriu> Hey bvancea
11:22 &lt;bvancea> hey sdumitriu
11:22 &lt;sdumitriu> What's up?
11:23 &lt;bvancea> pretty good, finished up reading the material for an exam
11:23 &lt;bvancea> and now I'm playing around with medsavant
11:23 &lt;bvancea> I loaded a larger db, over 1 million variants
11:25 &lt;bvancea> and you?
11:25 &lt;bvancea> did you manage to boot the laptop?
11:27 &lt;sdumitriu> Yep :)
11:28 &lt;bvancea> nice :D
11:28 &lt;sdumitriu> It was stupid, yesterday I register the bootloader wrong, then I registered it right and I tried to remove the wrong configuration
11:28 &lt;sdumitriu> But I deleted the right one :p
11:29 &lt;bvancea> oh, that sucks
11:29 &lt;bvancea> but atleast its working now
11:29 &lt;bvancea> :D
11:29 &lt;sdumitriu> Yep
11:29 &lt;bvancea> and you set up a dual boot?
11:29 &lt;bvancea> or only linux
11:29 &lt;sdumitriu> Dual
11:29 &lt;sdumitriu> All it needs is a proper driver for the touchpad
11:29 &lt;bvancea> nice
11:29 &lt;sdumitriu> It doesn't have gestures yet
11:30 &lt;bvancea> yeah
11:30 &lt;sdumitriu> But the touchscreen kind of works
11:30 &lt;sdumitriu> Fingerpainting in gimp is awesome
11:30 &lt;bvancea> =))
11:30 &lt;bvancea> that's really awesome
11:31 &lt;bvancea> is the fan working properly?
11:31 &lt;bvancea> my laptop overheats a lot under linux
11:32 &lt;sdumitriu> I guess it works, since it managed to compile a whole distro in a day without burning up
11:32 &lt;sdumitriu> But it's really silent
11:35 &lt;bvancea> nice
11:35 &lt;sdumitriu> Anyway, Marta's happy now
11:35 &lt;sdumitriu> The old one was dusty and it overheated
11:35 &lt;sdumitriu> After a few days it would shut down automatically
11:37 &lt;bvancea> yeah, that happens
11:37 &lt;bvancea> my laptop gave a scare during the weekend
11:37 &lt;bvancea> fan started making loud noises and then shut down
11:37 &lt;bvancea> had to open it up and clean it a little
11:38 &lt;bvancea> anyway, I wanted to talk to you about the schema for the variants
11:39 &lt;sdumitriu> Sure
11:39 &lt;sdumitriu> Why is Marc never here?
11:39 &lt;bvancea> um, I dunno
11:39 &lt;bvancea> aren't you all in the same lab?
11:39 &lt;bvancea> or is it a very large lab
11:39 &lt;sdumitriu> Yes
11:39 &lt;sdumitriu> No, we're 3 seconds away
11:40 &lt;bvancea> ah
11:40 &lt;bvancea> ;))
11:40 &lt;sdumitriu> Or about 50Db
11:40 &lt;bvancea> ;))
11:42 &lt;bvancea> well, from what I've seen so far, there should be no problem in keeping the patient dna id's as multi valued fields in solr
11:44 &lt;sdumitriu> Right
11:45 &lt;bvancea> and have the gt and zygosity kept as multi valued fields as well
11:45 &lt;bvancea> since you can't embed entities in the solr schema
11:47 &lt;bvancea> and if there are 3 values for the dna_id, there will be 3 values for the gt and 3 values for the zygosity
11:51 &lt;bvancea> does that make sense?
11:55 &lt;sdumitriu> Yes
11:56 &lt;sdumitriu> Or, you can use the join function
11:56 &lt;sdumitriu> wiki.apache.org/solr/Join
11:56 &lt;sdumitriu> Hm...
11:56 &lt;sdumitriu> Not sure it's useful though
11:56 &lt;sdumitriu> Or yes
11:57 &lt;sdumitriu> You can get the related info with a follow-up query
11:58 &lt;sdumitriu> I wonder if the order of the values is kept
11:58 &lt;sdumitriu> You should ask on their IRC channel
11:58 &lt;sdumitriu> Meaning that if you store 3 values for DNA, 3 for gt and 3 for zygo, will they always have the right order?
11:59 &lt;bvancea> hmm
11:59 &lt;bvancea> the order of the multi-valued fields?
11:59 &lt;sdumitriu> Hm, it's not good, since queries will match wrong documents
12:00 &lt;sdumitriu> If you search for variants that have a specific gt and a specific zygo, they could match two different variants
12:00 &lt;sdumitriu> I mean two different versions of the variant
12:00 &lt;sdumitriu> The gt from one pair, the zygo from another
12:01 &lt;bvancea> hmm
12:01 &lt;bvancea> you're right
12:02 &lt;bvancea> I need to test that, but I'm pretty sure you're right
12:02 &lt;sdumitriu> So Join looks like the best option
12:03 &lt;bvancea> yeah
12:03 &lt;bvancea> I think it's safe to say that keeping one document per dna id is not a good choice
12:03 &lt;sdumitriu> {!join from variant_id to id}(+gt:x +zygosity:y)
12:04 &lt;sdumitriu> We should test the performance in both cases
12:04 &lt;bvancea> hmm
12:04 &lt;sdumitriu> More documents vs. joined info
12:04 &lt;bvancea> it will be interesting
12:05 &lt;bvancea> since there may a lot of patients who share the variant
12:08 &lt;bvancea> I downloaded a 6mb .vcf file from 1000 genomes and it has well over 500 dna samples per variant
12:09 &lt;bvancea> but I'm really curious about the performance
12:13 &lt;sdumitriu> Oh, something interesting: http://www.lucenerevolution.org/2013/How-to-make-a-simple-cheap-high-availability-self-healing-Solr-cluster
12:14 &lt;bvancea> nice,they're finally up
12:14 &lt;bvancea> I've been waiting for the videos since the conference started
12:14 &lt;bvancea> but they delayed a few of them
12:15 &lt;bvancea> thanks :)
12:38 &lt;bvancea> has joined #medsavant
12:54 &lt;bvancea> interesting presentation
12:55 &lt;bvancea> so solr 4.3 has shard splitting, I wonder how well it works
12:55 &lt;sdumitriu> We're using 4.0, but we'll upgrade as soon as XWiki 5.1 is released
12:55 &lt;sdumitriu> (in about 2-3 weeks)
12:55 &lt;bvancea> nice
12:59 &lt;bvancea> there's not much documentation on that
12:59 &lt;bvancea> but I guess that splitting a shard will make one replica a leader
13:05 &lt;bvancea> about the joins, the way I see it, there will be different types of document for variants and different types for patient samples
13:05 &lt;bvancea> should we store them on different cores?
13:05 &lt;bvancea> or the same core
13:10 &lt;sdumitriu> Same
13:10 &lt;sdumitriu> I don't think you can join cross-cores
13:11 &lt;sdumitriu> Hm, I doubt those will work across shards
13:11 &lt;sdumitriu> So we'll have to make sure they're kept together on the same shard
13:12 &lt;bvancea> hmm
13:12 &lt;bvancea> even if they're on the same core
13:12 &lt;sdumitriu> Keeping multiple documents sounds better and better
13:12 &lt;bvancea> they might be hashed to a different shard
13:12 &lt;sdumitriu> Another argument: counting
13:14 &lt;bvancea> hmm, what exactly are you referring to by counting?
13:16 &lt;sdumitriu> "How many variants match these criterias?"
13:17 &lt;sdumitriu> How should a variant be counted? One for the whole group, or each entry individually?
13:17 &lt;sdumitriu> Right now it's each one
13:17 &lt;sdumitriu> So the count will be different
13:17 &lt;sdumitriu> And we don't want that
13:19 &lt;bvancea> hmm, true
13:20 &lt;sdumitriu> Anyway, I think the performance won't be much worse if we store each one individually
13:20 &lt;bvancea> probably not
13:20 &lt;bvancea> just the space requirments
13:22 &lt;bvancea> and if there are multiple documents, there shouldn't be problems with trying to keep them all on the same core
13:22 &lt;sdumitriu> Not even space
13:22 &lt;sdumitriu> Since the same tokens are used, it will just be one more ID per token
13:25 &lt;bvancea> hmm, I don't think I understand
13:26 &lt;sdumitriu> Well, Lucene work by storing a reverse index
13:26 &lt;sdumitriu> For each token, which documents have that token
13:26 &lt;bvancea> I thought all the fields except gt/zygosity are common to the variant documents
13:26 &lt;sdumitriu> Yes they are
13:27 &lt;sdumitriu> But when you make a new copy of the document, you're not copying the tokens
13:27 &lt;sdumitriu> You're just adding it's ID to the list of documents that have the token
13:27 &lt;bvancea> hmm, true
13:27 &lt;bvancea> but aren't the documents themselves stored
13:27 &lt;bvancea> ?
13:28 &lt;sdumitriu> Yes, but I'm assuming that it's also efficiently stored
13:28 &lt;sdumitriu> If not, then this is something that can be easily improved in Solr
13:29 &lt;bvancea> hmm, I need to check
13:30 &lt;bvancea> I mean test
13:35 &lt;bvancea> well, I'll start on the multiple documents per variant approach then
13:36 &lt;sdumitriu> That's the fastest solution
13:36 &lt;sdumitriu> Early optimization is bad
13:36 &lt;sdumitriu> We'll see later if we need to improve it somehow
13:36 &lt;bvancea> yup
13:39 &lt;bvancea> hm, apparently I did that
13:40 &lt;bvancea> I took the variants as they're parsed by medsavant parser and sent them to solr
13:41 &lt;bvancea> really ugly implementation though
19:16 &lt;marta> has joined #medsavant</content>
  <object>
    <name>IRC.medsavantArchive20130612</name>
    <number>0</number>
    <className>IRC.IRCBotArchiveClass</className>
    <guid>a78e5585-c524-4dca-b48c-20c7cbf229eb</guid>
    <class>
      <name>IRC.IRCBotArchiveClass</name>
      <customClass />
      <customMapping />
      <defaultViewSheet />
      <defaultEditSheet />
      <defaultWeb />
      <nameField />
      <validationScript />
      <channel>
        <customDisplay />
        <disabled>0</disabled>
        <name>channel</name>
        <number>1</number>
        <picker>0</picker>
        <prettyName>Channel</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage />
        <validationRegExp />
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </channel>
    </class>
    <property>
      <channel>medsavant</channel>
    </property>
  </object>
</xwikidoc>